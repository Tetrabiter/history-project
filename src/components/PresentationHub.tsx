import { useState } from "react";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Button } from "@/components/ui/button";
import {
  Dialog,
  DialogContent,
  DialogDescription,
  DialogHeader,
  DialogTitle,
} from "@/components/ui/dialog";
import {
  ArrowRight,
  GitFork,
  Scale,
  Coins,
  Globe,
  Sword,
  BookOpen,
} from "lucide-react";

// todo: remove mock functionality
const presentations = [
  {
    id: 1,
    title: "Преемственность vs. Разрыв",
    icon: GitFork,
    summary: "Советские строили на основе царского наследства или начали с нуля?",
    content: `Вопрос о преемственности и разрыве остается центральным для понимания русской индустриализации. Хотя большевики отвергли капиталистические рыночные механизмы имперской эры, они унаследовали и расширили ключевые элементы: стратегический фокус на железные дороги и тяжелую промышленность, традицию государственного вмешательства в экономику и цель военно-промышленной самодостаточности.

Методы, однако, представляли полную трансформацию. Имперская Россия интегрировалась в глобальные капиталистические рынки; СССР преследовал автаркию. Цари полагались на иностранных экспертов и инвестиции; Сталин требовал собственного развития и выгонял иностранный капитал. Наиболее драматично, общественный договор сместился от постепенной модернизации в рамках существующих классовых структур к революционному преобразованию через насилие и принуждение.`,
    era: "mixed",
  },
  {
    id: 2,
    title: "Роль государства",
    icon: Scale,
    summary: "От протекционистской политики к полной командной экономике.",
    content: `Обе эры отличались сильным государственным участием в индустриализации, но характер и масштаб принципиально различались. При реформах Витте имперское государство обеспечивало тарифную защиту, гарантировало железнодорожные облигации и направляло иностранные инвестиции в стратегические сектора, поддерживая частную собственность и рыночные механизмы.

Советская командная экономика устранила частную собственность на средства производства и заменила рыночные сигналы центральным планированием через Госплан. Производственные целевые показатели, распределение ресурсов и цены определялись администратором, а не спросом и предложением. Это позволило быстрой принудительной индустриализации, но создало системные неэффективности, которые мучили советскую экономику на протяжении всего ее существования.`,
    era: "mixed",
  },
  {
    id: 3,
    title: "Иностранный капитал и зависимость",
    icon: Coins,
    summary: "От французских кредитов к принудительной самодостаточности.",
    content: `Индустриализация Имперской России сильно зависела от иностранного капитала, особенно из Франции и Бельгии. К 1914 году примерно треть всего промышленного капитала была иностранной собственностью, и русское государство было крупнейшим должником в мире. Эта интеграция в мировой капитализм принесла технологию и опыт, но создала зависимость и уязвимость.

Индустриализация Сталина явно отвергла эту модель. После отказа от царских долгов и изгнания иностранных владельцев во время революции, СССР преследовал автаркию—экономическую самодостаточность. Пятилетние планы приоритизировали тяжелую промышленность именно для прекращения зависимости от капиталистических экономик в машинах и вооружениях, даже за счет благосостояния потребителей.`,
    era: "mixed",
  },
  {
    id: 4,
    title: "Интеграция vs. Изоляция",
    icon: Globe,
    summary: "Глобальные рынки или социалистическая крепость?",
    content: `Две модели индустриализации представляли противоположные видения места России в мировой экономике. Имперская Россия стремилась к интеграции в глобальную капиталистическую систему: принятию золотого стандарта, привлечению иностранных инвестиций, экспорту зерна для финансирования индустриализации и участию в международных торговых сетях.

Советский Союз, рожденный революцией и столкнувшийся с "капиталистическим окружением", преследовал противоположную стратегию. Экономическая изоляция была и идеологической необходимостью, и стратегическим выбором. Построив промышленную базу независимо от капиталистических рынков, СССР стремился пережить—и в конечном итоге победить—своих идеологических врагов. Эта изоляция защищала от внешнего экономического давления, но ограничивала доступ к технологиям и рынкам.`,
    era: "mixed",
  },
  {
    id: 5,
    title: "Подготовка к войне",
    icon: Sword,
    summary: "Военные нужды как движущая сила промышленной политики.",
    content: `В обеих эрах военные соображения глубоко формировали приоритеты индустриализации. Позорное поражение Имперской России в Крымской войне (1856) и близкое поражение от Японии (1905) обнажили технологическую отсталость и спровоцировали реформы. Железные дороги строились для военной мобильности столько же, сколько для экономического развития.

Советская индустриализация была еще более явно милитаризирована. Знаменитая речь Сталина 1931 года провозгласила: "Мы отстаем на пятьдесят или сто лет от развитых стран. Мы должны преодолеть это расстояние за десять лет. Либо мы это сделаем, либо нас раздавят." Первый пятилетний план приоритизировал именно те тяжелые отрасли—сталь, машины, вооружения—необходимые для современной войны. Когда нацистская Германия напала в 1941 году, эта промышленная база оказалась решающей.`,
    era: "mixed",
  },
  {
    id: 6,
    title: "Историческое наследие",
    icon: BookOpen,
    summary: "Долгосрочные последствия каждого пути развития.",
    content: `Обе модели индустриализации оставили долгосрочное наследие, которое формировало траекторию России. Имперская модель создала острова современности—концентрировалась в Санкт-Петербурге, Москве и Донбассе—оставляя подавляющее большинство крестьян в основном нетронутыми. Это неравномерное развитие способствовало революционной нестабильности.

Советская индустриализация трансформировала СССР в сверхдержаву, способную разгромить нацистскую Германию и конкурировать с Соединенными Штатами. Но упор на тяжелую промышленность в ущерб потребительским товарам, разрушение частного сельского хозяйства и наследие террора и принуждения создали глубокие структурные проблемы. Неэффективность командной экономики в конечном итоге способствовала краху СССР в 1991 году, оставляя Россию снова искать путь к модернизации.`,
    era: "mixed",
  },
];

export function PresentationHub() {
  const [selectedPresentation, setSelectedPresentation] = useState<typeof presentations[0] | null>(null);

  return (
    <section className="py-16 lg:py-24 bg-muted/30" data-testid="section-presentations">
      <div className="max-w-7xl mx-auto px-4">
        <div className="text-center mb-12">
          <h2 className="font-serif text-3xl lg:text-4xl font-bold mb-4">
            Ключевые вопросы и анализ
          </h2>
          <p className="text-muted-foreground max-w-2xl mx-auto font-serif">
            Исследуйте центральные темы и дебаты вокруг русской 
            индустриализации через структурированный исторический анализ.
          </p>
        </div>

        <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
          {presentations.map((pres) => (
            <Card
              key={pres.id}
              className="hover-elevate cursor-pointer"
              onClick={() => setSelectedPresentation(pres)}
              data-testid={`presentation-card-${pres.id}`}
            >
              <CardHeader>
                <div className="flex items-center gap-3">
                  <div className="p-2 rounded-md bg-primary/10">
                    <pres.icon className="w-5 h-5 text-primary" />
                  </div>
                  <CardTitle className="font-serif text-lg">{pres.title}</CardTitle>
                </div>
              </CardHeader>
              <CardContent>
                <p className="text-muted-foreground text-sm mb-4">{pres.summary}</p>
                <Button variant="ghost" size="sm" className="w-full font-serif">
                  Прочитать анализ
                  <ArrowRight className="w-4 h-4 ml-2" />
                </Button>
              </CardContent>
            </Card>
          ))}
        </div>
      </div>

      <Dialog open={!!selectedPresentation} onOpenChange={() => setSelectedPresentation(null)}>
        {selectedPresentation && (
          <DialogContent className="max-w-2xl max-h-[80vh] overflow-y-auto">
            <DialogHeader>
              <div className="flex items-center gap-3 mb-2">
                <div className="p-2 rounded-md bg-primary/10">
                  <selectedPresentation.icon className="w-5 h-5 text-primary" />
                </div>
                <Badge variant="secondary" className="font-serif">Исторический анализ</Badge>
              </div>
              <DialogTitle className="font-serif text-2xl">
                {selectedPresentation.title}
              </DialogTitle>
              <DialogDescription className="font-serif">{selectedPresentation.summary}</DialogDescription>
            </DialogHeader>
            <div className="prose prose-sm dark:prose-invert max-w-none">
              {selectedPresentation.content.split("\n\n").map((paragraph, idx) => (
                <p key={idx} className="text-foreground leading-relaxed">
                  {paragraph}
                </p>
              ))}
            </div>
          </DialogContent>
        )}
      </Dialog>
    </section>
  );
}
